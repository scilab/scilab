// =============================================================================
// Scilab ( http://www.scilab.org/ ) - This file is part of Scilab
// Copyright (C) 2009 - DIGITEO - Allan CORNET
//
//  This file is distributed under the same license as the Scilab package.
// =============================================================================
// <-- CLI SHELL MODE -->
// <-- Non-regression test for bug 4638 -->
//
// <-- Bugzilla URL -->
// http://bugzilla.scilab.org/show_bug.cgi?id=4638
//
// <-- Short Description -->
// this example with optim freezes scilab
// =============================================================================
function A = build_matrix_A()
A = spzeros(36,36);
 
A(    1,    1) =         12.356155 ;
A(    1,    2) =         1.8561553 ;
A(    1,    5) =       - 5.25 ;
A(    1,    7) =       - 1.8561553 ;
A(    1,    8) =       - 1.8561553 ;
A(    2,    1) =         1.8561553 ;
A(    2,    2) =         7.1061553 ;
A(    2,    4) =       - 5.25 ;
A(    2,    7) =       - 1.8561553 ;
A(    2,    8) =       - 1.8561553 ;
A(    3,    3) =         8.9623106 ;
A(    3,    5) =       - 1.8561553 ;
A(    3,    6) =         1.8561553 ;
A(    3,    7) =       - 5.25 ;
A(    4,    2) =       - 5.25 ;
A(    4,    4) =         8.9623106 ;
A(    4,    5) =         1.8561553 ;
A(    4,    6) =       - 1.8561553 ;
A(    5,    1) =       - 5.25 ;
A(    5,    3) =       - 1.8561553 ;
A(    5,    4) =         1.8561553 ;
A(    5,    5) =         14.212311 ;
A(    5,    9) =       - 5.25 ;
A(    5,   11) =       - 1.8561553 ;
A(    5,   12) =       - 1.8561553 ;
A(    6,    3) =         1.8561553 ;
A(    6,    4) =       - 1.8561553 ;
A(    6,    6) =         8.9623106 ;
A(    6,    8) =       - 5.25 ;
A(    6,   11) =       - 1.8561553 ;
A(    6,   12) =       - 1.8561553 ;
A(    7,    1) =       - 1.8561553 ;
A(    7,    2) =       - 1.8561553 ;
A(    7,    3) =       - 5.25 ;
A(    7,    7) =         14.212311 ;
A(    7,    9) =       - 1.8561553 ;
A(    7,   10) =         1.8561553 ;
A(    7,   11) =       - 5.25 ;
A(    8,    1) =       - 1.8561553 ;
A(    8,    2) =       - 1.8561553 ;
A(    8,    6) =       - 5.25 ;
A(    8,    8) =         8.9623106 ;
A(    8,    9) =         1.8561553 ;
A(    8,   10) =       - 1.8561553 ;
A(    9,    5) =       - 5.25 ;
A(    9,    7) =       - 1.8561553 ;
A(    9,    8) =         1.8561553 ;
A(    9,    9) =         14.212311 ;
A(    9,   13) =       - 5.25 ;
A(    9,   15) =       - 1.8561553 ;
A(    9,   16) =       - 1.8561553 ;
A(   10,    7) =         1.8561553 ;
A(   10,    8) =       - 1.8561553 ;
A(   10,   10) =         8.9623106 ;
A(   10,   12) =       - 5.25 ;
A(   10,   15) =       - 1.8561553 ;
A(   10,   16) =       - 1.8561553 ;
A(   11,    5) =       - 1.8561553 ;
A(   11,    6) =       - 1.8561553 ;
A(   11,    7) =       - 5.25 ;
A(   11,   11) =         14.212311 ;
A(   11,   13) =       - 1.8561553 ;
A(   11,   14) =         1.8561553 ;
A(   11,   15) =       - 5.25 ;
A(   12,    5) =       - 1.8561553 ;
A(   12,    6) =       - 1.8561553 ;
A(   12,   10) =       - 5.25 ;
A(   12,   12) =         8.9623106 ;
A(   12,   13) =         1.8561553 ;
A(   12,   14) =       - 1.8561553 ;
A(   13,    9) =       - 5.25 ;
A(   13,   11) =       - 1.8561553 ;
A(   13,   12) =         1.8561553 ;
A(   13,   13) =         14.212311 ;
A(   13,   17) =       - 5.25 ;
A(   13,   19) =       - 1.8561553 ;
A(   13,   20) =       - 1.8561553 ;
A(   14,   11) =         1.8561553 ;
A(   14,   12) =       - 1.8561553 ;
A(   14,   14) =         8.9623106 ;
A(   14,   16) =       - 5.25 ;
A(   14,   19) =       - 1.8561553 ;
A(   14,   20) =       - 1.8561553 ;
A(   15,    9) =       - 1.8561553 ;
A(   15,   10) =       - 1.8561553 ;
A(   15,   11) =       - 5.25 ;
A(   15,   15) =         14.212311 ;
A(   15,   17) =       - 1.8561553 ;
A(   15,   18) =         1.8561553 ;
A(   15,   19) =       - 5.25 ;
A(   16,    9) =       - 1.8561553 ;
A(   16,   10) =       - 1.8561553 ;
A(   16,   14) =       - 5.25 ;
A(   16,   16) =         8.9623106 ;
A(   16,   17) =         1.8561553 ;
A(   16,   18) =       - 1.8561553 ;
A(   17,   13) =       - 5.25 ;
A(   17,   15) =       - 1.8561553 ;
A(   17,   16) =         1.8561553 ;
A(   17,   17) =         14.212311 ;
A(   17,   21) =       - 5.25 ;
A(   17,   23) =       - 1.8561553 ;
A(   17,   24) =       - 1.8561553 ;
A(   18,   15) =         1.8561553 ;
A(   18,   16) =       - 1.8561553 ;
A(   18,   18) =         8.9623106 ;
A(   18,   20) =       - 5.25 ;
A(   18,   23) =       - 1.8561553 ;
A(   18,   24) =       - 1.8561553 ;
A(   19,   13) =       - 1.8561553 ;
A(   19,   14) =       - 1.8561553 ;
A(   19,   15) =       - 5.25 ;
A(   19,   19) =         14.212311 ;
A(   19,   21) =       - 1.8561553 ;
A(   19,   22) =         1.8561553 ;
A(   19,   23) =       - 5.25 ;
A(   20,   13) =       - 1.8561553 ;
A(   20,   14) =       - 1.8561553 ;
A(   20,   18) =       - 5.25 ;
A(   20,   20) =         8.9623106 ;
A(   20,   21) =         1.8561553 ;
A(   20,   22) =       - 1.8561553 ;
A(   21,   17) =       - 5.25 ;
A(   21,   19) =       - 1.8561553 ;
A(   21,   20) =         1.8561553 ;
A(   21,   21) =         14.212311 ;
A(   21,   25) =       - 5.25 ;
A(   21,   27) =       - 1.8561553 ;
A(   21,   28) =       - 1.8561553 ;
A(   22,   19) =         1.8561553 ;
A(   22,   20) =       - 1.8561553 ;
A(   22,   22) =         8.9623106 ;
A(   22,   24) =       - 5.25 ;
A(   22,   27) =       - 1.8561553 ;
A(   22,   28) =       - 1.8561553 ;
A(   23,   17) =       - 1.8561553 ;
A(   23,   18) =       - 1.8561553 ;
A(   23,   19) =       - 5.25 ;
A(   23,   23) =         14.212311 ;
A(   23,   25) =       - 1.8561553 ;
A(   23,   26) =         1.8561553 ;
A(   23,   27) =       - 5.25 ;
A(   24,   17) =       - 1.8561553 ;
A(   24,   18) =       - 1.8561553 ;
A(   24,   22) =       - 5.25 ;
A(   24,   24) =         8.9623106 ;
A(   24,   25) =         1.8561553 ;
A(   24,   26) =       - 1.8561553 ;
A(   25,   21) =       - 5.25 ;
A(   25,   23) =       - 1.8561553 ;
A(   25,   24) =         1.8561553 ;
A(   25,   25) =         14.212311 ;
A(   25,   29) =       - 5.25 ;
A(   25,   31) =       - 1.8561553 ;
A(   25,   32) =       - 1.8561553 ;
A(   26,   23) =         1.8561553 ;
A(   26,   24) =       - 1.8561553 ;
A(   26,   26) =         8.9623106 ;
A(   26,   28) =       - 5.25 ;
A(   26,   31) =       - 1.8561553 ;
A(   26,   32) =       - 1.8561553 ;
A(   27,   21) =       - 1.8561553 ;
A(   27,   22) =       - 1.8561553 ;
A(   27,   23) =       - 5.25 ;
A(   27,   27) =         14.212311 ;
A(   27,   29) =       - 1.8561553 ;
A(   27,   30) =         1.8561553 ;
A(   27,   31) =       - 5.25 ;
A(   28,   21) =       - 1.8561553 ;
A(   28,   22) =       - 1.8561553 ;
A(   28,   26) =       - 5.25 ;
A(   28,   28) =         8.9623106 ;
A(   28,   29) =         1.8561553 ;
A(   28,   30) =       - 1.8561553 ;
A(   29,   25) =       - 5.25 ;
A(   29,   27) =       - 1.8561553 ;
A(   29,   28) =         1.8561553 ;
A(   29,   29) =         14.212311 ;
A(   29,   33) =       - 5.25 ;
A(   29,   35) =       - 1.8561553 ;
A(   29,   36) =       - 1.8561553 ;
A(   30,   27) =         1.8561553 ;
A(   30,   28) =       - 1.8561553 ;
A(   30,   30) =         8.9623106 ;
A(   30,   32) =       - 5.25 ;
A(   30,   35) =       - 1.8561553 ;
A(   30,   36) =       - 1.8561553 ;
A(   31,   25) =       - 1.8561553 ;
A(   31,   26) =       - 1.8561553 ;
A(   31,   27) =       - 5.25 ;
A(   31,   31) =         14.212311 ;
A(   31,   33) =       - 1.8561553 ;
A(   31,   34) =         1.8561553 ;
A(   31,   35) =       - 5.25 ;
A(   32,   25) =       - 1.8561553 ;
A(   32,   26) =       - 1.8561553 ;
A(   32,   30) =       - 5.25 ;
A(   32,   32) =         8.9623106 ;
A(   32,   33) =         1.8561553 ;
A(   32,   34) =       - 1.8561553 ;
A(   33,   29) =       - 5.25 ;
A(   33,   31) =       - 1.8561553 ;
A(   33,   32) =         1.8561553 ;
A(   33,   33) =         12.356155 ;
A(   33,   34) =       - 1.8561553 ;
A(   34,   31) =         1.8561553 ;
A(   34,   32) =       - 1.8561553 ;
A(   34,   33) =       - 1.8561553 ;
A(   34,   34) =         7.1061553 ;
A(   34,   36) =       - 5.25 ;
A(   35,   29) =       - 1.8561553 ;
A(   35,   30) =       - 1.8561553 ;
A(   35,   31) =       - 5.25 ;
A(   35,   35) =         8.9623106 ;
A(   36,   29) =       - 1.8561553 ;
A(   36,   30) =       - 1.8561553 ;
A(   36,   34) =       - 5.25 ;
A(   36,   36) =         8.9623106 ;
A = A * 1.0D+08;
endfunction
function [y, dy, ind] = optim_test(x,ind)
  printf('hello from optim_test\n');
  y = sum(x.^2);
  dy = 2*x;
  A = build_matrix_A();
  Ainv = inv(A);
endfunction
[f_opt, x_opt] = optim(optim_test,ones(10,1));
hello from optim_test
hello from optim_test
hello from optim_test
// =============================================================================
